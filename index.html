
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Blood of the Ronin - Katana 3 Frame</title>
<style>
body { margin:0; background:black; overflow:hidden; }
canvas { display:block; }
#ui {
  position:fixed;
  bottom:0;
  width:100%;
  height:80px;
  background:linear-gradient(#1a0000,#000);
  border-top:3px solid #550000;
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:serif;
}
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="ui">⚔️ Oni Samurai - 3 Frame Katana</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight - 80;

let player = {x:canvas.width/2, y:canvas.height/2, dir:0};
let enemies = [];
let particles = [];
let attacking = false;
let attackFrame = 0;

function spawnEnemy(){
  enemies.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    hp:30
  });
}
for(let i=0;i<6;i++) spawnEnemy();

canvas.addEventListener("touchstart", handleInput);
canvas.addEventListener("mousedown", handleInput);

function handleInput(e){
  let x = e.touches ? e.touches[0].clientX : e.clientX;
  let y = e.touches ? e.touches[0].clientY : e.clientY;

  let dx = x - player.x;
  let dy = y - player.y;
  player.dir = Math.atan2(dy,dx);

  player.x = x;
  player.y = y;

  attacking = true;
  attackFrame = 0;
  setTimeout(()=>attacking=false,300);
}

function spawnBlood(x,y){
  for(let i=0;i<8;i++){
    particles.push({
      x,y,
      vx:(Math.random()-0.5)*4,
      vy:(Math.random()-0.5)*4,
      life:30
    });
  }
}

function update(){
  if(attacking){
    attackFrame++;
  }

  enemies.forEach(enemy=>{
    let dx = player.x - enemy.x;
    let dy = player.y - enemy.y;
    let dist = Math.sqrt(dx*dx+dy*dy);

    if(dist>0){
      enemy.x += dx/dist*0.6;
      enemy.y += dy/dist*0.6;
    }

    if(attacking && dist < 60 && attackFrame === 2){
      enemy.hp -= 15;
      spawnBlood(enemy.x,enemy.y);
    }
  });

  enemies = enemies.filter(e=>e.hp>0);
  if(enemies.length < 6) spawnEnemy();

  particles.forEach(p=>{
    p.x += p.vx;
    p.y += p.vy;
    p.life--;
  });
  particles = particles.filter(p=>p.life>0);
}

function drawKatana(x,y,angle,frame){
  ctx.save();
  ctx.translate(x,y);

  let swingOffset = 0;
  if(frame === 0) swingOffset = -0.8;
  if(frame === 1) swingOffset = 0;
  if(frame === 2) swingOffset = 0.8;

  ctx.rotate(angle + swingOffset);

  // blade
  ctx.fillStyle="#cccccc";
  ctx.fillRect(0,-2,45,4);

  // handle
  ctx.fillStyle="#552200";
  ctx.fillRect(-8,-3,8,6);

  ctx.restore();
}

function drawPlayer(){
  // body
  ctx.fillStyle="#770000";
  ctx.fillRect(player.x-10,player.y-10,20,20);

  // head
  ctx.fillStyle="#cc0000";
  ctx.fillRect(player.x-6,player.y-18,12,10);

  // horns
  ctx.fillStyle="#ffffcc";
  ctx.fillRect(player.x-8,player.y-20,4,6);
  ctx.fillRect(player.x+4,player.y-20,4,6);

  // eyes
  ctx.fillStyle= attacking ? "#ffff00" : "#ffffff";
  ctx.fillRect(player.x-3,player.y-15,2,2);
  ctx.fillRect(player.x+1,player.y-15,2,2);

  if(attacking){
    drawKatana(player.x,player.y,player.dir,attackFrame%3);
  }
}

function drawEnemies(){
  enemies.forEach(e=>{
    ctx.fillStyle="#004400";
    ctx.fillRect(e.x-10,e.y-10,20,20);
  });
}

function draw(){
  ctx.fillStyle="#111";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  drawEnemies();
  drawPlayer();

  ctx.fillStyle="#aa0000";
  particles.forEach(p=>{
    ctx.fillRect(p.x,p.y,3,3);
  });

  let gradient = ctx.createRadialGradient(player.x,player.y,60,player.x,player.y,220);
  gradient.addColorStop(0,"rgba(0,0,0,0)");
  gradient.addColorStop(1,"rgba(0,0,0,0.9)");
  ctx.fillStyle = gradient;
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

function gameLoop(){
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
