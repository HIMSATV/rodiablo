
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Blood of the Ronin - Advanced</title>
<style>
body { margin:0; background:black; overflow:hidden; }
canvas { display:block; }
#ui {
  position:absolute;
  top:10px;
  left:10px;
  color:white;
  font-family:Arial;
}
</style>
</head>
<body>
<div id="ui">
HP: <span id="hp">100</span>
</div>
<canvas id="game"></canvas>
<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = {x:canvas.width/2, y:canvas.height/2, hp:100};
let enemies = [];
let boss = null;
let attacking = false;

function spawnEnemy(){
  enemies.push({
    x:Math.random()*canvas.width,
    y:Math.random()*canvas.height,
    hp:30
  });
}

function spawnBoss(){
  boss = {x:canvas.width/2, y:100, hp:300};
}

for(let i=0;i<5;i++) spawnEnemy();

canvas.addEventListener("touchstart", handleInput);
canvas.addEventListener("mousedown", handleInput);

function handleInput(e){
  let x = e.touches ? e.touches[0].clientX : e.clientX;
  let y = e.touches ? e.touches[0].clientY : e.clientY;
  player.x = x;
  player.y = y;
  attacking = true;
  setTimeout(()=>attacking=false,200);
}

function update(){
  enemies.forEach(enemy=>{
    let dx = player.x - enemy.x;
    let dy = player.y - enemy.y;
    let dist = Math.sqrt(dx*dx+dy*dy);
    if(dist>0){
      enemy.x += dx/dist;
      enemy.y += dy/dist;
    }

    if(dist < 20){
      player.hp -= 0.2;
    }

    if(attacking && dist < 50){
      enemy.hp -= 5;
    }
  });

  enemies = enemies.filter(e=>e.hp>0);

  if(enemies.length==0 && !boss){
    spawnBoss();
  }

  if(boss){
    let dx = player.x - boss.x;
    let dy = player.y - boss.y;
    let dist = Math.sqrt(dx*dx+dy*dy);
    if(dist>0){
      boss.x += dx/dist*0.5;
      boss.y += dy/dist*0.5;
    }

    if(dist < 30){
      player.hp -= 0.5;
    }

    if(attacking && dist < 60){
      boss.hp -= 3;
    }
  }

  document.getElementById("hp").innerText = Math.max(0,Math.floor(player.hp));
}

function draw(){
  ctx.fillStyle="black";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.save();
  ctx.beginPath();
  ctx.arc(player.x,player.y,150,0,Math.PI*2);
  ctx.clip();

  ctx.fillStyle="red";
  enemies.forEach(e=>{
    ctx.beginPath();
    ctx.arc(e.x,e.y,10,0,Math.PI*2);
    ctx.fill();
  });

  if(boss){
    ctx.fillStyle="purple";
    ctx.beginPath();
    ctx.arc(boss.x,boss.y,25,0,Math.PI*2);
    ctx.fill();
  }

  ctx.fillStyle = attacking ? "yellow" : "white";
  ctx.beginPath();
  ctx.arc(player.x,player.y,12,0,Math.PI*2);
  ctx.fill();

  ctx.restore();
}

function gameLoop(){
  update();
  draw();
  requestAnimationFrame(gameLoop);
}

gameLoop();
</script>
</body>
</html>
