
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Blood of the Ronin - Abyss Axe</title>
<style>
body { margin:0; background:black; overflow:hidden; }
canvas { display:block; }
#ui {
  position:fixed;
  bottom:0;
  width:100%;
  height:80px;
  background:linear-gradient(#140000,#000);
  border-top:3px solid #550000;
  color:white;
  display:flex;
  justify-content:center;
  align-items:center;
  font-family:serif;
}
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="ui">ðŸª“ Oni Executioner - Abyss Dungeon</div>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight - 80;

const TILE = 40;
const COLS = Math.floor(canvas.width / TILE);
const ROWS = Math.floor(canvas.height / TILE);

let dungeon = [];
for(let y=0;y<ROWS;y++){
  dungeon[y]=[];
  for(let x=0;x<COLS;x++){
    dungeon[y][x] = (Math.random() < 0.18) ? 1 : 0; // walls
  }
}

let audioCtx = new (window.AudioContext || window.webkitAudioContext)();
function startMusic(){
  let osc1 = audioCtx.createOscillator();
  let osc2 = audioCtx.createOscillator();
  let gain = audioCtx.createGain();
  osc1.type="sawtooth";
  osc2.type="triangle";
  osc1.frequency.value=55;
  osc2.frequency.value=73;
  gain.gain.value=0.03;
  osc1.connect(gain);
  osc2.connect(gain);
  gain.connect(audioCtx.destination);
  osc1.start();
  osc2.start();
}
startMusic();

function playHit(){
  let osc = audioCtx.createOscillator();
  let gain = audioCtx.createGain();
  osc.type="square";
  osc.frequency.value=120;
  gain.gain.value=0.15;
  osc.connect(gain);
  gain.connect(audioCtx.destination);
  osc.start();
  osc.stop(audioCtx.currentTime+0.1);
}

let player = {x:canvas.width/2,y:canvas.height/2,dir:0};
let enemies=[];
let particles=[];
let attacking=false;
let axeFrame=0;

function spawnEnemy(){
  enemies.push({x:Math.random()*canvas.width,y:Math.random()*canvas.height,hp:40});
}
for(let i=0;i<6;i++) spawnEnemy();

canvas.addEventListener("touchstart", handleInput);
canvas.addEventListener("mousedown", handleInput);

function handleInput(e){
  audioCtx.resume();
  let x = e.touches?e.touches[0].clientX:e.clientX;
  let y = e.touches?e.touches[0].clientY:e.clientY;
  let dx=x-player.x, dy=y-player.y;
  player.dir=Math.atan2(dy,dx);
  if(!isWall(x,y)){
    player.x=x;
    player.y=y;
  }
  attacking=true;
  axeFrame=0;
  setTimeout(()=>attacking=false,300);
}

function isWall(px,py){
  let gx=Math.floor(px/TILE);
  let gy=Math.floor(py/TILE);
  if(gx<0||gy<0||gx>=COLS||gy>=ROWS) return true;
  return dungeon[gy][gx]===1;
}

function spawnBlood(x,y){
  for(let i=0;i<12;i++){
    particles.push({x,y,vx:(Math.random()-0.5)*6,vy:(Math.random()-0.5)*6,life:40});
  }
}

function spawnGib(x,y){
  for(let i=0;i<6;i++){
    particles.push({x,y,vx:(Math.random()-0.5)*8,vy:(Math.random()-0.5)*8,life:60,chunk:true});
  }
}

function update(){
  if(attacking) axeFrame = (axeFrame+1)%3;

  enemies.forEach(enemy=>{
    let dx=player.x-enemy.x;
    let dy=player.y-enemy.y;
    let dist=Math.sqrt(dx*dx+dy*dy);
    if(dist>0 && !isWall(enemy.x+dx/dist*0.5, enemy.y+dy/dist*0.5)){
      enemy.x+=dx/dist*0.5;
      enemy.y+=dy/dist*0.5;
    }
    if(attacking && dist<70){
      enemy.hp-=20;
      spawnBlood(enemy.x,enemy.y);
      playHit();
      if(enemy.hp<=0) spawnGib(enemy.x,enemy.y);
    }
  });

  enemies=enemies.filter(e=>e.hp>0);
  if(enemies.length<6) spawnEnemy();

  particles.forEach(p=>{p.x+=p.vx;p.y+=p.vy;p.life--;});
  particles=particles.filter(p=>p.life>0);
}

function drawDungeon(){
  for(let y=0;y<ROWS;y++){
    for(let x=0;x<COLS;x++){
      if(dungeon[y][x]===1){
        ctx.fillStyle="#222";
        ctx.fillRect(x*TILE,y*TILE,TILE,TILE);
      }
    }
  }
}

function drawAxe(x,y,angle,frame){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(angle + frame*0.5);
  ctx.fillStyle="#bbb";
  ctx.fillRect(-5,-25,10,50);
  ctx.fillRect(-20,-5,40,10);
  ctx.restore();
}

function drawPlayer(){
  ctx.fillStyle="#770000";
  ctx.fillRect(player.x-10,player.y-10,20,20);
  if(attacking) drawAxe(player.x,player.y,player.dir,axeFrame);
}

function drawEnemies(){
  enemies.forEach(e=>{
    ctx.fillStyle="#004400";
    ctx.fillRect(e.x-10,e.y-10,20,20);
  });
}

function drawParticles(){
  particles.forEach(p=>{
    ctx.fillStyle = p.chunk ? "#550000" : "#aa0000";
    ctx.fillRect(p.x,p.y,4,4);
  });
}

function draw(){
  ctx.fillStyle="#111";
  ctx.fillRect(0,0,canvas.width,canvas.height);
  drawDungeon();
  drawEnemies();
  drawPlayer();
  drawParticles();

  let gradient=ctx.createRadialGradient(player.x,player.y,80,player.x,player.y,260);
  gradient.addColorStop(0,"rgba(0,0,0,0)");
  gradient.addColorStop(1,"rgba(0,0,0,0.9)");
  ctx.fillStyle=gradient;
  ctx.fillRect(0,0,canvas.width,canvas.height);
}

function loop(){
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
