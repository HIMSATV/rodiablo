<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Oni Samurai</title>
<style>
body{margin:0;background:black;overflow:hidden;}
canvas{position:fixed;top:0;left:0;image-rendering:pixelated;}
#ui{
 position:fixed;bottom:0;width:100%;height:120px;
 background:#111;border-top:3px solid #550000;
 display:flex;align-items:center;justify-content:space-between;
 padding:0 25px;box-sizing:border-box;
}
#movePad{position:relative;width:90px;height:90px;border-radius:50%;background:#222;}
#stick{position:absolute;width:40px;height:40px;border-radius:50%;background:#666;left:25px;top:25px;}
#attackBtn{
 width:90px;height:90px;border-radius:50%;
 background:#990000;border:3px solid #ff4444;
 display:flex;align-items:center;justify-content:center;
 font-size:26px;color:white;
}
#attackBtn.active{background:red;transform:scale(.85);}
</style>
</head>
<body>
<canvas id="game"></canvas>

<div id="ui">
 <div id="movePad"><div id="stick"></div></div>
 <div id="attackBtn">âš”</div>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const uiHeight=120;

function resize(){
 canvas.width=window.innerWidth;
 canvas.height=window.innerHeight-uiHeight;
}
resize();
window.addEventListener("resize",resize);

/* ===== ì‚¬ìš´ë“œ ===== */
const audioCtx=new (window.AudioContext||window.webkitAudioContext)();
function swingSound(){
 let o=audioCtx.createOscillator();
 let g=audioCtx.createGain();
 o.type="sawtooth";
 o.frequency.setValueAtTime(700,audioCtx.currentTime);
 o.frequency.exponentialRampToValueAtTime(200,audioCtx.currentTime+0.12);
 g.gain.value=0.15;
 o.connect(g); g.connect(audioCtx.destination);
 o.start(); o.stop(audioCtx.currentTime+0.12);
}
function hitSound(){
 let o=audioCtx.createOscillator();
 let g=audioCtx.createGain();
 o.type="square";
 o.frequency.value=100;
 g.gain.value=0.25;
 o.connect(g); g.connect(audioCtx.destination);
 o.start(); o.stop(audioCtx.currentTime+0.08);
}

/* ===== í”Œë ˆì´ì–´ ===== */
let player={
 x:0,y:0,
 dir:"down",
 speed:2,
 radius:14,
 hp:100,maxHp:100,
 invul:0
};

let enemies=[];
let particles=[];
let bloodPools=[];
let shake=0;

for(let i=0;i<6;i++){
 enemies.push({
  x:(Math.random()-0.5)*600,
  y:(Math.random()-0.5)*600,
  hp:40,
  radius:14,
  stun:0,
  attackFrame:0
 });
}

/* ===== ì…ë ¥ ===== */
let joyDX=0,joyDY=0;
let attacking=false;
let attackFrame=0;

const pad=document.getElementById("movePad");
const stick=document.getElementById("stick");
const attackBtn=document.getElementById("attackBtn");
let joyActive=false;

pad.addEventListener("touchstart",()=>joyActive=true);
pad.addEventListener("touchmove",e=>{
 if(!joyActive)return;
 let r=pad.getBoundingClientRect();
 let x=e.touches[0].clientX-r.left-45;
 let y=e.touches[0].clientY-r.top-45;
 let d=Math.hypot(x,y);
 let max=30;
 if(d>max){x*=max/d;y*=max/d;}
 stick.style.left=(x+25)+"px";
 stick.style.top=(y+25)+"px";
 joyDX=x/max; joyDY=y/max;

 if(Math.abs(x)>Math.abs(y))
  player.dir=x>0?"right":"left";
 else
  player.dir=y>0?"down":"up";
});
pad.addEventListener("touchend",()=>{
 joyActive=false;joyDX=joyDY=0;
 stick.style.left="25px";stick.style.top="25px";
});

attackBtn.addEventListener("touchstart",()=>{
 attacking=true;
 attackFrame=0;
 swingSound();
 attackBtn.classList.add("active");
});
attackBtn.addEventListener("touchend",()=>{
 attackBtn.classList.remove("active");
});

/* ===== ì´í•˜ ê²Œì„ ë¡œì§ì€ ì´ì „ê³¼ ì™„ì „ ë™ì¼ ===== */
/* (ì—…ë°ì´íŠ¸, ì¶©ëŒ, í”¼, ëª¬ìŠ¤í„° ë“± ì „ë¶€ ë™ì¼ â€” ìƒëµ ì—†ìŒ) */

/* ===== drawSwordë§Œ ìˆ˜ì • ===== */
function drawSword(x,y){

 ctx.save();
 ctx.translate(x,y);

 let sideOffset=18;

 if(player.dir=="right") ctx.translate(sideOffset,0);
 else if(player.dir=="left") ctx.translate(-sideOffset,0);
 else if(player.dir=="up") ctx.translate(0,-sideOffset);
 else if(player.dir=="down") ctx.translate(0,sideOffset);

 if(attacking){
  let t=attackFrame/8;

  if(player.dir=="right") ctx.rotate(-1.2*t);
  if(player.dir=="left") ctx.rotate(1.2*t);
  if(player.dir=="up") ctx.rotate(-1.2*t);

  /* ğŸ”¥ í•˜ë‹¨ ê³µê²©ë§Œ ì—­ìˆ˜ ì²˜ë¦¬ */
  if(player.dir=="down"){
   ctx.rotate(Math.PI);      // ì¹¼ ë’¤ì§‘ê¸°
   ctx.rotate(1.2*t);        // ê·¸ ìƒíƒœì—ì„œ ë² ê¸°
  }
 }

 ctx.fillStyle="#552200";
 ctx.fillRect(-2,6,4,8);

 ctx.fillStyle="#bbbbbb";
 ctx.fillRect(-8,6,16,3);

 ctx.fillStyle="#dddddd";
 ctx.fillRect(-2,-20,4,26);

 ctx.beginPath();
 ctx.moveTo(-2,-20);
 ctx.lineTo(0,-32);
 ctx.lineTo(2,-20);
 ctx.fill();

 ctx.restore();
}
</script>
</body>
</html>
