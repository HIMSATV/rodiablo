<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rodiablo</title>
<style>
body{margin:0;background:#000;overflow:hidden;}
canvas{display:block;background:#0a0a0a;}
</style>
</head>
<body>
<canvas id="game"></canvas>
<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

function resize(){
 canvas.width=window.innerWidth;
 canvas.height=window.innerHeight;
}
resize();
window.addEventListener("resize",resize);

const TILE_W=64;
const TILE_H=32;

const palette={
 floor:"#2a2a2a",
 floor2:"#1f1f1f",
 playerBody:"#6b0000",
 playerHead:"#d9b38c",
 katana:"#cfd2d6",
 goblin:"#2f5e2f",
 skeleton:"#d8d8d8",
 blood:"#5a0000"
};

let player={x:5,y:5,attacking:false,attackFrame:0};
let monsters=[
 {type:"goblin",x:7,y:6,hp:3},
 {type:"skeleton",x:3,y:4,hp:2},
 {type:"goblin",x:8,y:3,hp:3}
];

function isoToScreen(x,y){
 return{
  x:(x-y)*(TILE_W/2)+canvas.width/2,
  y:(x+y)*(TILE_H/2)+100
 };
}

function drawTile(x,y){
 const pos=isoToScreen(x,y);
 ctx.beginPath();
 ctx.moveTo(pos.x,pos.y);
 ctx.lineTo(pos.x+TILE_W/2,pos.y+TILE_H/2);
 ctx.lineTo(pos.x,pos.y+TILE_H);
 ctx.lineTo(pos.x-TILE_W/2,pos.y+TILE_H/2);
 ctx.closePath();
 ctx.fillStyle=(x+y)%2?palette.floor:palette.floor2;
 ctx.fill();
}

function drawPlayer(){
 const pos=isoToScreen(player.x,player.y);

 // shadow
 ctx.fillStyle="rgba(0,0,0,0.6)";
 ctx.beginPath();
 ctx.ellipse(pos.x,pos.y+15,12,6,0,0,Math.PI*2);
 ctx.fill();

 // body
 ctx.fillStyle=palette.playerBody;
 ctx.fillRect(pos.x-8,pos.y-20,16,20);

 // head
 ctx.fillStyle=palette.playerHead;
 ctx.fillRect(pos.x-5,pos.y-28,10,8);

 // attack animation
 if(player.attacking){
   ctx.strokeStyle=palette.katana;
   ctx.lineWidth=4;
   ctx.beginPath();
   ctx.moveTo(pos.x,pos.y-15);
   ctx.lineTo(pos.x+25-player.attackFrame*5,pos.y-35+player.attackFrame*3);
   ctx.stroke();
 }
}

function drawMonster(m){
 const pos=isoToScreen(m.x,m.y);

 ctx.fillStyle="rgba(0,0,0,0.6)";
 ctx.beginPath();
 ctx.ellipse(pos.x,pos.y+12,10,5,0,0,Math.PI*2);
 ctx.fill();

 if(m.type==="goblin"){
   ctx.fillStyle=palette.goblin;
   ctx.fillRect(pos.x-10,pos.y-18,20,18);
   ctx.fillRect(pos.x-6,pos.y-26,12,8);
 }

 if(m.type==="skeleton"){
   ctx.fillStyle=palette.skeleton;
   ctx.fillRect(pos.x-8,pos.y-18,16,18);
   ctx.fillRect(pos.x-5,pos.y-26,10,8);
   ctx.fillStyle="#000";
   ctx.fillRect(pos.x-3,pos.y-22,2,2);
   ctx.fillRect(pos.x+1,pos.y-22,2,2);
 }
}

function updateCombat(){
 monsters.forEach((m,i)=>{
  if(Math.abs(m.x-player.x)<=1 && Math.abs(m.y-player.y)<=1){
    player.attacking=true;
    player.attackFrame++;
    if(player.attackFrame>4){
      m.hp--;
      player.attackFrame=0;
      player.attacking=false;
    }
    if(m.hp<=0){
      monsters.splice(i,1);
    }
  }
 });
}

canvas.addEventListener("touchstart",(e)=>{
 const rect=canvas.getBoundingClientRect();
 const tx=e.touches[0].clientX-rect.left;
 const ty=e.touches[0].clientY-rect.top;

 for(let y=0;y<10;y++){
  for(let x=0;x<10;x++){
   const pos=isoToScreen(x,y);
   if(Math.abs(tx-pos.x)<32 && Math.abs(ty-pos.y)<16){
    player.x=x;
    player.y=y;
   }
  }
 }
});

function loop(){
 ctx.clearRect(0,0,canvas.width,canvas.height);

 for(let y=0;y<10;y++){
  for(let x=0;x<10;x++){
   drawTile(x,y);
  }
 }

 updateCombat();

 monsters.forEach(drawMonster);
 drawPlayer();

 requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
