<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Axe Warrior</title>
<style>
body{margin:0;background:black;overflow:hidden;}
canvas{display:block;}

#hpBar{
 position:fixed;
 top:15px;
 left:50%;
 transform:translateX(-50%);
 width:220px;
 height:20px;
 background:#330000;
 border:2px solid #aa0000;
}
#hpFill{height:100%;width:100%;background:red;}

#uiBar{
 position:fixed;
 bottom:0;
 width:100%;
 height:140px;
 background:linear-gradient(#1a0000,#000);
 border-top:3px solid #550000;
}

#joystickBase{
 position:absolute;
 left:40px;
 bottom:20px;
 width:120px;height:120px;
 border-radius:50%;
 background:rgba(255,255,255,0.08);
}
#joystick{
 position:absolute;
 width:60px;height:60px;
 border-radius:50%;
 background:rgba(255,255,255,0.25);
 left:30px;top:30px;
}

#attackBtn{
 position:absolute;
 right:40px;
 bottom:35px;
 width:90px;height:90px;
 border-radius:50%;
 background:radial-gradient(circle,#aa0000,#440000);
 border:3px solid #ff4444;
 display:flex;align-items:center;justify-content:center;
 color:white;font-size:22px;
}
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="hpBar"><div id="hpFill"></div></div>

<div id="uiBar">
 <div id="joystickBase"><div id="joystick"></div></div>
 <div id="attackBtn">⚔</div>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight-140;

let player={
 x:canvas.width/2,
 y:canvas.height/2,
 dir:0,
 speed:2,
 radius:18,
 hp:100,
 maxHp:100,
 invincible:0
};

let enemies=[];
let particles=[];
let attacking=false;
let attackCooldown=0;
let screenShake=0;

/* 적 생성 */
function spawnEnemy(){
 enemies.push({
  x:Math.random()*canvas.width,
  y:Math.random()*canvas.height,
  hp:40,
  radius:14,
  attackCooldown:0
 });
}
for(let i=0;i<6;i++) spawnEnemy();

/* 자동 타겟 */
function findClosest(){
 let min=9999,target=null;
 enemies.forEach(e=>{
  let d=Math.hypot(e.x-player.x,e.y-player.y);
  if(d<min){min=d;target=e;}
 });
 return target;
}

/* 공격 */
document.getElementById("attackBtn").addEventListener("touchstart",attack);
document.getElementById("attackBtn").addEventListener("mousedown",attack);

function attack(){
 if(attackCooldown>0) return;
 let target=findClosest();
 if(!target) return;

 let dx=target.x-player.x;
 let dy=target.y-player.y;
 let dist=Math.hypot(dx,dy);
 if(dist>120) return;

 player.dir=Math.atan2(dy,dx);
 attacking=true;
 attackCooldown=25;

 enemies.forEach(e=>{
  let dx=e.x-player.x;
  let dy=e.y-player.y;
  let dist=Math.hypot(dx,dy);
  let angle=Math.atan2(dy,dx);
  let diff=Math.abs(angle-player.dir);

  if(dist<95 && diff<0.9){
   e.hp-=20;
   spawnBlood(e.x,e.y);
   if(e.hp<=0){
     explode(e.x,e.y);
     screenShake=12;
   }
  }
 });

 setTimeout(()=>attacking=false,200);
}

/* 이펙트 */
function explode(x,y){
 for(let i=0;i<20;i++){
  particles.push({
   x,y,
   vx:(Math.random()-0.5)*6,
   vy:(Math.random()-0.5)*6,
   life:40,
   color:"orange"
  });
 }
}
function spawnBlood(x,y){
 for(let i=0;i<8;i++){
  particles.push({
   x,y,
   vx:(Math.random()-0.5)*4,
   vy:(Math.random()-0.5)*4,
   life:25,
   color:"red"
  });
 }
}

/* 조이스틱 */
let joyActive=false,joyDX=0,joyDY=0;
const base=document.getElementById("joystickBase");
const stick=document.getElementById("joystick");

base.addEventListener("touchstart",()=>joyActive=true);
base.addEventListener("touchmove",e=>{
 if(!joyActive)return;
 let r=base.getBoundingClientRect();
 let x=e.touches[0].clientX-r.left;
 let y=e.touches[0].clientY-r.top;
 joyDX=x-60; joyDY=y-60;
 let d=Math.hypot(joyDX,joyDY);
 if(d>50){joyDX=joyDX/d*50;joyDY=joyDY/d*50;}
 stick.style.left=(joyDX+30)+"px";
 stick.style.top=(joyDY+30)+"px";
});
base.addEventListener("touchend",()=>{
 joyActive=false;joyDX=joyDY=0;
 stick.style.left="30px";stick.style.top="30px";
});

/* 충돌 */
function resolveCollision(a,b){
 let dx=a.x-b.x;
 let dy=a.y-b.y;
 let dist=Math.hypot(dx,dy);
 let min=a.radius+b.radius;
 if(dist<min && dist>0){
  let push=(min-dist)/2;
  a.x+=dx/dist*push;
  a.y+=dy/dist*push;
  b.x-=dx/dist*push;
  b.y-=dy/dist*push;
 }
}

/* 업데이트 */
function update(){

 if(joyActive){
  player.x+=joyDX/50*player.speed;
  player.y+=joyDY/50*player.speed;
 }

 enemies.forEach(e=>{
  let dx=player.x-e.x;
  let dy=player.y-e.y;
  let dist=Math.hypot(dx,dy);
  if(dist>0){
   e.x+=dx/dist*0.6;
   e.y+=dy/dist*0.6;
  }
  resolveCollision(player,e);

  if(dist<25 && e.attackCooldown<=0){
   if(player.invincible<=0){
    player.hp-=10;
    player.invincible=30;
    screenShake=8;
   }
   e.attackCooldown=60;
  }
  if(e.attackCooldown>0) e.attackCooldown--;
 });

 enemies=enemies.filter(e=>e.hp>0);
 if(enemies.length<6) spawnEnemy();

 particles.forEach(p=>{
  p.x+=p.vx;p.y+=p.vy;p.life--;
 });
 particles=particles.filter(p=>p.life>0);

 if(attackCooldown>0) attackCooldown--;
 if(player.invincible>0) player.invincible--;
 if(screenShake>0) screenShake--;

 document.getElementById("hpFill").style.width=
   (player.hp/player.maxHp*100)+"%";
}

/* ===== 캐릭터 (정면 고정) ===== */
function drawPlayer(x,y){

 ctx.save();
 ctx.translate(x,y);

 // 그림자
 ctx.fillStyle="black";
 ctx.beginPath();
 ctx.ellipse(0,20,20,8,0,0,Math.PI*2);
 ctx.fill();

 // 다리
 ctx.fillStyle="#330000";
 ctx.fillRect(-6,10,4,14);
 ctx.fillRect(2,10,4,14);

 // 몸통
 ctx.fillStyle="#5a0000";
 ctx.fillRect(-10,-6,20,22);

 // 어깨
 ctx.fillStyle="#8b0000";
 ctx.fillRect(-16,-6,8,6);
 ctx.fillRect(8,-6,8,6);

 // 머리
 ctx.fillStyle="#770000";
 ctx.beginPath();
 ctx.arc(0,-16,10,0,Math.PI*2);
 ctx.fill();

 // 뿔
 ctx.fillStyle="#ddd";
 ctx.beginPath();
 ctx.moveTo(-5,-22);
 ctx.lineTo(-2,-36);
 ctx.lineTo(1,-22);
 ctx.fill();

 ctx.beginPath();
 ctx.moveTo(5,-22);
 ctx.lineTo(2,-36);
 ctx.lineTo(-1,-22);
 ctx.fill();

 // 눈
 ctx.fillStyle="yellow";
 ctx.fillRect(-4,-17,3,3);
 ctx.fillRect(1,-17,3,3);

 /* ===== 도끼 ===== */
 ctx.save();
 ctx.rotate(player.dir);

 let swing = attacking ? Math.sin(Date.now()/40)*1.2 : 0;
 ctx.rotate(swing);

 // 자루
 ctx.fillStyle="#5a3a1a";
 ctx.fillRect(0,-3,50,6);

 // 양날 도끼날
 ctx.fillStyle="#c0b090";

 ctx.beginPath();
 ctx.moveTo(50,-18);
 ctx.lineTo(75,0);
 ctx.lineTo(50,18);
 ctx.closePath();
 ctx.fill();

 ctx.beginPath();
 ctx.moveTo(50,-18);
 ctx.lineTo(25,0);
 ctx.lineTo(50,18);
 ctx.closePath();
 ctx.fill();

 ctx.restore();

 ctx.restore();
}

/* 몬스터 */
function drawGoblin(x,y){
 ctx.fillStyle="black";
 ctx.beginPath();
 ctx.arc(x,y+3,14,0,Math.PI*2);
 ctx.fill();

 ctx.fillStyle="#003300";
 ctx.beginPath();
 ctx.arc(x,y,12,0,Math.PI*2);
 ctx.fill();

 ctx.fillStyle="#00aa00";
 ctx.beginPath();
 ctx.arc(x,y-4,8,0,Math.PI*2);
 ctx.fill();

 ctx.fillStyle="#ccff00";
 ctx.fillRect(x-3,y-3,2,2);
 ctx.fillRect(x+1,y-3,2,2);
}

function draw(){
 ctx.save();
 if(screenShake>0){
  ctx.translate(
   (Math.random()-0.5)*screenShake,
   (Math.random()-0.5)*screenShake
  );
 }

 ctx.fillStyle="#0d0d0d";
 ctx.fillRect(0,0,canvas.width,canvas.height);

 enemies.forEach(e=>drawGoblin(e.x,e.y));
 drawPlayer(player.x,player.y);

 particles.forEach(p=>{
  ctx.fillStyle=p.color;
  ctx.fillRect(p.x,p.y,3,3);
 });

 ctx.restore();
}

function loop(){
 update();
 draw();
 requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
