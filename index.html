<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport"
 content="width=device-width,
 initial-scale=1.0,
 maximum-scale=1.0,
 user-scalable=no,
 viewport-fit=cover">

<title>Blood of the Ronin</title>

<style>
body{ margin:0; background:black; overflow:hidden; }

canvas{
 position:fixed;
 top:0;
 left:0;
}

/* UI */
#ui{
 position:fixed;
 bottom:0;
 width:100%;
 height:110px;
 padding-bottom:env(safe-area-inset-bottom);
 background:linear-gradient(#1a0000,#000);
 border-top:3px solid #550000;
 display:flex;
 align-items:center;
 justify-content:space-between;
 padding:0 25px;
 box-sizing:border-box;
}

#movePad{
 width:80px;height:80px;
 border-radius:50%;
 background:rgba(255,255,255,0.1);
 border:2px solid #555;
}

#hpContainer{
 flex:1;margin:0 20px;
 height:18px;
 background:#330000;
 border:2px solid #990000;
}
#hpBar{
 height:100%;
 width:100%;
 background:#ff0000;
}

#attackBtn{
 width:80px;height:80px;
 border-radius:50%;
 background:#990000;
 border:3px solid #ff4444;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:26px;
 color:white;
 transition:0.1s;
}
#attackBtn.active{
 background:#ff0000;
 transform:scale(0.9);
 box-shadow:0 0 20px #ff0000;
}
</style>
</head>
<body>

<canvas id="game"></canvas>

<div id="ui">
 <div id="movePad"></div>
 <div id="hpContainer"><div id="hpBar"></div></div>
 <div id="attackBtn">⚔</div>
</div>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
const uiHeight=110;

function resize(){
 canvas.width=window.innerWidth;
 canvas.height=window.innerHeight-uiHeight;
}
resize();
window.addEventListener("resize",resize);

/* 플레이어 */
let player={
 x:canvas.width/2,
 y:canvas.height/2,
 hp:100,
 dir:0
};

let enemies=[];
for(let i=0;i<5;i++){
 enemies.push({
  x:Math.random()*canvas.width,
  y:Math.random()*canvas.height,
  hp:30
 });
}

let attacking=false;

/* 공격 버튼 */
const attackBtn=document.getElementById("attackBtn");

function startAttack(){
 attacking=true;
 attackBtn.classList.add("active");
 setTimeout(()=>{
  attacking=false;
  attackBtn.classList.remove("active");
 },200);
}

attackBtn.addEventListener("touchstart",startAttack);
attackBtn.addEventListener("mousedown",startAttack);

/* HP 업데이트 */
function updateHP(){
 document.getElementById("hpBar").style.width=player.hp+"%";
}

/* 이동 (터치하면 이동) */
canvas.addEventListener("touchstart",movePlayer);
canvas.addEventListener("mousedown",movePlayer);

function movePlayer(e){
 let x=e.touches?e.touches[0].clientX:e.clientX;
 let y=e.touches?e.touches[0].clientY:e.clientY;
 player.dir=Math.atan2(y-player.y,x-player.x);
 player.x=x;
 player.y=y;
}

/* 업데이트 */
function update(){
 enemies.forEach(enemy=>{
  let dx=player.x-enemy.x;
  let dy=player.y-enemy.y;
  let dist=Math.hypot(dx,dy);
  if(dist>1){
   enemy.x+=dx/dist*0.6;
   enemy.y+=dy/dist*0.6;
  }

  if(attacking && dist<60){
   enemy.hp-=10;
  }

  if(dist<20){
   player.hp-=0.1;
  }
 });

 enemies=enemies.filter(e=>e.hp>0);
 updateHP();
}

/* 오니 사무라이 */
function drawOni(x,y){
 ctx.fillStyle="#770000";
 ctx.fillRect(x-15,y-15,30,30);

 ctx.fillStyle="#cc0000";
 ctx.fillRect(x-10,y-25,20,10);

 ctx.fillStyle="#ffffcc";
 ctx.fillRect(x-12,y-28,6,8);
 ctx.fillRect(x+6,y-28,6,8);

 ctx.fillStyle="#ffffff";
 ctx.fillRect(x-5,y-18,3,3);
 ctx.fillRect(x+2,y-18,3,3);

 if(attacking){
  ctx.save();
  ctx.translate(x,y);
  ctx.rotate(player.dir);
  ctx.fillStyle="#cccccc";
  ctx.fillRect(0,-3,40,6);
  ctx.restore();
 }
}

/* 도깨비 */
function drawGoblin(x,y){
 ctx.fillStyle="#004400";
 ctx.fillRect(x-15,y-15,30,30);

 ctx.fillStyle="#00aa00";
 ctx.fillRect(x-10,y-25,20,10);

 ctx.fillStyle="#ffffff";
 ctx.fillRect(x-6,y-20,3,3);
 ctx.fillRect(x+3,y-20,3,3);
}

/* 렌더 */
function draw(){
 ctx.fillStyle="#111";
 ctx.fillRect(0,0,canvas.width,canvas.height);

 enemies.forEach(e=>drawGoblin(e.x,e.y));
 drawOni(player.x,player.y);

 requestAnimationFrame(draw);
}

function gameLoop(){
 update();
 draw();
 requestAnimationFrame(gameLoop);
}
gameLoop();
</script>
</body>
</html>
