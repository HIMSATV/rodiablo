<!DOCTYPE html>
<html lang="ko">
<head>
<meta charset="UTF-8">
<title>8 Direction Samurai</title>
<style>
html,body{margin:0;overflow:hidden;background:#000;}
canvas{display:block;}
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");
canvas.width=window.innerWidth;
canvas.height=window.innerHeight;

const TILE_W=64;
const TILE_H=32;

let player={
  x:10,
  y:10,
  speed:0.12,
  dir:4,          // 0~7
  frame:0,
  animTimer:0,
  moving:false
};

let keys={};
document.addEventListener("keydown",e=>keys[e.key]=true);
document.addEventListener("keyup",e=>keys[e.key]=false);

let camera={x:10,y:10};

function isoToScreen(x,y){
  const relX=x-camera.x;
  const relY=y-camera.y;
  return {
    x:(relX-relY)*(TILE_W/2)+canvas.width/2,
    y:(relX+relY)*(TILE_H/2)+canvas.height/2
  };
}

function update(){

  let dx=0, dy=0;
  player.moving=false;

  if(keys["w"]){ dy-=1; player.moving=true; }
  if(keys["s"]){ dy+=1; player.moving=true; }
  if(keys["a"]){ dx-=1; player.moving=true; }
  if(keys["d"]){ dx+=1; player.moving=true; }

  if(dx!==0||dy!==0){
    const len=Math.hypot(dx,dy);
    dx/=len; dy/=len;
    player.x+=dx*player.speed;
    player.y+=dy*player.speed;

    // 방향 계산 (8방향)
    const angle=Math.atan2(dy,dx);
    const oct=Math.round(8*angle/(2*Math.PI)+8)%8;
    player.dir=oct;
  }

  if(player.moving){
    player.animTimer++;
    if(player.animTimer>10){
      player.frame=(player.frame+1)%2;
      player.animTimer=0;
    }
  }else{
    player.frame=0;
  }

  camera.x+=(player.x-camera.x)*0.1;
  camera.y+=(player.y-camera.y)*0.1;
}

function drawSamurai(){

  const p=isoToScreen(player.x,player.y);

  ctx.save();
  ctx.translate(p.x,p.y);

  // 그림자
  ctx.fillStyle="rgba(0,0,0,0.4)";
  ctx.beginPath();
  ctx.ellipse(0,0,14,6,0,0,Math.PI*2);
  ctx.fill();

  ctx.translate(0,-36);

  // 걷기 프레임 다리 흔들림
  const legOffset=player.frame===0? -2:2;

  // 다리
  ctx.fillStyle="#2b2b2b";
  ctx.fillRect(-6,12+legOffset,5,18);
  ctx.fillRect(1,12-legOffset,5,18);

  // 갑주 몸통
  ctx.fillStyle="#7a1f1f";
  ctx.fillRect(-8,-2,16,18);

  // 어깨 갑주
  ctx.fillStyle="#999";
  ctx.fillRect(-10,-6,20,6);

  // 머리
  ctx.fillStyle="#e0c097";
  ctx.fillRect(-5,-14,10,8);

  // 투구
  ctx.fillStyle="#550000";
  ctx.fillRect(-6,-18,12,6);

  // 투구 장식
  ctx.fillStyle="#aa0000";
  ctx.fillRect(-2,-24,4,6);

  // 방향별 카타나 위치
  ctx.strokeStyle="#ccc";
  ctx.lineWidth=2;
  ctx.beginPath();

  const swordDir=[
    [20,-10],[20,-20],[10,-25],[0,-30],
    [-20,-25],[-20,-15],[-10,-5],[10,-5]
  ];

  const s=swordDir[player.dir];
  ctx.moveTo(6,-4);
  ctx.lineTo(s[0],s[1]);
  ctx.stroke();

  ctx.restore();
}

function render(){
  ctx.clearRect(0,0,canvas.width,canvas.height);
  drawSamurai();
}

function loop(){
  update();
  render();
  requestAnimationFrame(loop);
}

loop();

window.addEventListener("resize",()=>{
  canvas.width=window.innerWidth;
  canvas.height=window.innerHeight;
});
</script>
</body>
</html>
