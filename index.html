<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport"
 content="width=device-width,
 initial-scale=1.0,
 maximum-scale=1.0,
 user-scalable=no,
 viewport-fit=cover">

<title>Pixel Axe Stable</title>

<style>
html,body{
 margin:0;
 padding:0;
 background:#000;
 overflow:hidden;
 touch-action:none;
}

/* iOS 안전영역 변수 */
:root{
 --safe-bottom: env(safe-area-inset-bottom);
}

#game{
 position:fixed;
 top:0;
 left:0;
}

#hpBar{
 position:fixed;
 top:calc(10px + env(safe-area-inset-top));
 left:50%;
 transform:translateX(-50%);
 width:200px;height:16px;
 background:#400;
 border:2px solid #a00;
 z-index:10;
}
#hpFill{
 height:100%;
 width:100%;
 background:#f00;
}

#uiBar{
 position:fixed;
 bottom:0;
 left:0;
 width:100%;
 height:calc(140px + var(--safe-bottom));
 padding-bottom:var(--safe-bottom);
 background:#200;
 border-top:3px solid #500;
 z-index:10;
 display:flex;
 justify-content:flex-end;
 align-items:center;
}

#attackBtn{
 margin-right:40px;
 width:90px;height:90px;
 border-radius:50%;
 background:#900;
 border:3px solid #f44;
 display:flex;
 align-items:center;
 justify-content:center;
 color:white;
 font-size:22px;
}
</style>
</head>
<body>

<canvas id="game"></canvas>
<div id="hpBar"><div id="hpFill"></div></div>

<div id="uiBar">
 <div id="attackBtn">⚔</div>
</div>

<script>

/* 확대 완전 차단 */
document.addEventListener('gesturestart', e=>e.preventDefault());
document.addEventListener('gesturechange', e=>e.preventDefault());
document.addEventListener('gestureend', e=>e.preventDefault());

let lastTouchEnd = 0;
document.addEventListener('touchend', function (event) {
 let now = Date.now();
 if (now - lastTouchEnd <= 300) event.preventDefault();
 lastTouchEnd = now;
}, {passive:false});

/* ===== 정확한 높이 계산 ===== */
const canvas=document.getElementById("game");
const ctx=canvas.getContext("2d");

function resize(){

 const safeBottom =
  parseFloat(getComputedStyle(document.documentElement)
  .getPropertyValue("--safe-bottom")) || 0;

 const uiHeight = 140 + safeBottom;

 const realHeight =
  window.innerHeight - uiHeight;

 canvas.width = window.innerWidth;
 canvas.height = realHeight;

 canvas.style.width = window.innerWidth+"px";
 canvas.style.height = realHeight+"px";

 ctx.imageSmoothingEnabled=false;
}

window.addEventListener("resize",resize);
resize();

/* 테스트 체크무늬 */
function draw(){
 const size=64;
 for(let x=0;x<canvas.width;x+=size){
  for(let y=0;y<canvas.height;y+=size){
   const check=((x/size+y/size)%2);
   ctx.fillStyle=check?"#1a1a1a":"#111";
   ctx.fillRect(x,y,size,size);
  }
 }
 requestAnimationFrame(draw);
}
draw();

</script>
</body>
</html>
