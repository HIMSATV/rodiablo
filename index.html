
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no">
<title>Ronin - Dismemberment Build</title>
<style>
body { margin:0; background:black; overflow:hidden; }
canvas { display:block; }
</style>
</head>
<body>
<canvas id="game"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
canvas.width = window.innerWidth;
canvas.height = window.innerHeight;

let player = {x:canvas.width/2,y:canvas.height/2,dir:0};
let enemies=[];
let corpses=[];
let particles=[];
let attacking=false;
let attackFrame=0;

function spawnEnemy(){
 enemies.push({
  x:Math.random()*canvas.width,
  y:Math.random()*canvas.height,
  hp:40
 });
}
for(let i=0;i<6;i++) spawnEnemy();

canvas.addEventListener("mousedown",input);
canvas.addEventListener("touchstart",input);

function input(e){
 let x=e.touches?e.touches[0].clientX:e.clientX;
 let y=e.touches?e.touches[0].clientY:e.clientY;

 let dx=x-player.x;
 let dy=y-player.y;
 player.dir=Math.atan2(dy,dx);

 player.x=x;
 player.y=y;

 attacking=true;
 attackFrame=0;
 setTimeout(()=>attacking=false,300);
}

function spawnBlood(x,y){
 for(let i=0;i<12;i++){
  particles.push({
   x,y,
   vx:(Math.random()-0.5)*8,
   vy:(Math.random()-0.5)*8,
   life:50
  });
 }
}

function dismember(enemy){
 corpses.push({
   x:enemy.x,
   y:enemy.y,
   topOffset:0,
   bottomOffset:0,
   vx:(Math.random()-0.5)*2,
   life:120
 });
}

function update(){
 if(attacking) attackFrame++;

 enemies.forEach(enemy=>{
  let dx=player.x-enemy.x;
  let dy=player.y-enemy.y;
  let dist=Math.sqrt(dx*dx+dy*dy);

  if(dist>0){
   enemy.x+=dx/dist*0.7;
   enemy.y+=dy/dist*0.7;
  }

  if(attacking && dist<60 && attackFrame===2){
   enemy.hp-=40;
   spawnBlood(enemy.x,enemy.y);
   if(enemy.hp<=0){
    dismember(enemy);
   }
  }
 });

 enemies=enemies.filter(e=>e.hp>0);
 if(enemies.length<6) spawnEnemy();

 particles.forEach(p=>{
  p.x+=p.vx;
  p.y+=p.vy;
  p.life--;
 });
 particles=particles.filter(p=>p.life>0);

 corpses.forEach(c=>{
  c.topOffset -= 0.5;
  c.bottomOffset += 0.5;
  c.x += c.vx;
  c.life--;
 });
 corpses=corpses.filter(c=>c.life>0);
}

function drawPlayer(){
 ctx.fillStyle="#550000";
 ctx.fillRect(player.x-12,player.y-12,24,24);
 ctx.fillStyle="#aa0000";
 ctx.fillRect(player.x-8,player.y-22,16,12);
}

function draw(){
 ctx.fillStyle="#111";
 ctx.fillRect(0,0,canvas.width,canvas.height);

 // enemies
 enemies.forEach(e=>{
  ctx.fillStyle="#003300";
  ctx.fillRect(e.x-12,e.y-12,24,24);
 });

 // corpses (split body)
 corpses.forEach(c=>{
  ctx.fillStyle="#004400";
  ctx.fillRect(c.x-12,c.y-12+c.topOffset,24,12); // upper body
  ctx.fillRect(c.x-12,c.y+c.bottomOffset,24,12); // lower body
 });

 drawPlayer();

 // blood
 ctx.fillStyle="#aa0000";
 particles.forEach(p=>{
  ctx.fillRect(p.x,p.y,3,3);
 });

 // ---- Torch Lighting ----
 let torchFlicker = 80 + Math.sin(Date.now()*0.01)*10;
 let gradient = ctx.createRadialGradient(
   player.x,player.y,50,
   player.x,player.y,torchFlicker
 );
 gradient.addColorStop(0,"rgba(255,140,0,0.15)");
 gradient.addColorStop(0.4,"rgba(0,0,0,0.2)");
 gradient.addColorStop(1,"rgba(0,0,0,0.95)");
 ctx.fillStyle=gradient;
 ctx.fillRect(0,0,canvas.width,canvas.height);
}

function loop(){
 update();
 draw();
 requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
